<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Nacosæ•°æ®æ¨¡å‹</title>
    <link href="/2021/07/27/nacos-data-model/"/>
    <url>/2021/07/27/nacos-data-model/</url>
    
    <content type="html"><![CDATA[<h2 id="æ•°æ®æ¨¡å‹"><a href="#æ•°æ®æ¨¡å‹" class="headerlink" title="æ•°æ®æ¨¡å‹"></a>æ•°æ®æ¨¡å‹</h2><p>Nacos æ•°æ®æ¨¡å‹ Key ç”±ä¸‰å…ƒç»„å”¯ä¸€ç¡®è®¤ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/images/nacos/nacos-data-model.jpeg" alt="ç‚¹å‡»"></p><ul><li>ä½œä¸ºæ³¨å†Œä¸­å¿ƒæ—¶ï¼ŒNamespace + Group + Service</li><li>ä½œä¸ºé…ç½®ä¸­å¿ƒæ—¶ï¼ŒNamespace + Group + DataId</li></ul><h2 id="Namespace-å‘½åç©ºé—´"><a href="#Namespace-å‘½åç©ºé—´" class="headerlink" title="Namespace å‘½åç©ºé—´"></a>Namespace å‘½åç©ºé—´</h2><p>ç”¨äºè¿›è¡Œç§Ÿæˆ·ç²’åº¦çš„é…ç½®éš”ç¦»ã€‚é»˜è®¤ä¸º publicï¼ˆå…¬å…±å‘½åç©ºé—´ï¼‰ã€‚</p><p>ä¸åŒçš„å‘½åç©ºé—´ä¸‹ï¼Œå¯ä»¥å­˜åœ¨ç›¸åŒçš„ Group æˆ– Data ID çš„é…ç½®ã€‚Namespace çš„å¸¸ç”¨åœºæ™¯ä¹‹ä¸€æ˜¯ä¸åŒç¯å¢ƒçš„é…ç½®çš„åŒºåˆ†éš”ç¦»ï¼Œä¾‹å¦‚å¼€å‘æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„èµ„æºï¼ˆå¦‚é…ç½®ã€æœåŠ¡ï¼‰éš”ç¦»ç­‰ã€‚</p><h2 id="Group-æœåŠ¡åˆ†ç»„"><a href="#Group-æœåŠ¡åˆ†ç»„" class="headerlink" title="Group æœåŠ¡åˆ†ç»„"></a>Group æœåŠ¡åˆ†ç»„</h2><p>ä¸åŒçš„æœåŠ¡å¯ä»¥å½’ç±»åˆ°åŒä¸€åˆ†ç»„ã€‚é»˜è®¤ä¸º DEFAULT_GROUPï¼ˆé»˜è®¤åˆ†ç»„ï¼‰ã€‚</p><h2 id="Service-æœåŠ¡"><a href="#Service-æœåŠ¡" class="headerlink" title="Service æœåŠ¡"></a>Service æœåŠ¡</h2><p>ä¾‹å¦‚è¯´ï¼Œç”¨æˆ·æœåŠ¡ã€è®¢å•æœåŠ¡ã€å•†å“æœåŠ¡ç­‰ç­‰ã€‚</p><h2 id="å®˜æ–¹æ–‡æ¡£"><a href="#å®˜æ–¹æ–‡æ¡£" class="headerlink" title="å®˜æ–¹æ–‡æ¡£"></a>å®˜æ–¹æ–‡æ¡£</h2><ul><li><a href="https://nacos.io/zh-cn/docs/what-is-nacos.html">ã€ŠNacos å®˜æ–¹æ–‡æ¡£ â€”â€” æ¦‚å¿µã€‹</a></li><li><a href="https://nacos.io/zh-cn/docs/architecture.html">ã€ŠNacos å®˜æ–¹æ–‡æ¡£ â€”â€” æ¶æ„ã€‹</a></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Nacos</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nacosæ³¨å†Œä¸­å¿ƒ</title>
    <link href="/2021/07/27/nacos-discovery/"/>
    <url>/2021/07/27/nacos-discovery/</url>
    
    <content type="html"><![CDATA[<h3 id="æœåŠ¡å‘ç°å’ŒæœåŠ¡å¥åº·ç›‘æµ‹"><a href="#æœåŠ¡å‘ç°å’ŒæœåŠ¡å¥åº·ç›‘æµ‹" class="headerlink" title="æœåŠ¡å‘ç°å’ŒæœåŠ¡å¥åº·ç›‘æµ‹"></a><strong>æœåŠ¡å‘ç°å’ŒæœåŠ¡å¥åº·ç›‘æµ‹</strong></h3><p>Nacos æ”¯æŒåŸºäº DNS å’ŒåŸºäº RPC çš„æœåŠ¡å‘ç°ã€‚æœåŠ¡æä¾›è€…ä½¿ç”¨ <a href="https://nacos.io/zh-cn/docs/sdk.html">åŸç”ŸSDK</a>ã€<a href="https://nacos.io/zh-cn/docs/open-api.html">OpenAPI</a>ã€æˆ–ä¸€ä¸ª<a href="https://nacos.io/zh-cn/docs/other-language.html">ç‹¬ç«‹çš„Agent TODO</a>æ³¨å†Œ Service åï¼ŒæœåŠ¡æ¶ˆè´¹è€…å¯ä»¥ä½¿ç”¨<a href="https://nacos.io/zh-cn/docs/xx">DNS TODO</a> æˆ–<a href="https://nacos.io/zh-cn/docs/open-api.html">HTTP&amp;API</a>æŸ¥æ‰¾å’Œå‘ç°æœåŠ¡ã€‚</p><p>Nacos æä¾›å¯¹æœåŠ¡çš„å®æ—¶çš„å¥åº·æ£€æŸ¥ï¼Œé˜»æ­¢å‘ä¸å¥åº·çš„ä¸»æœºæˆ–æœåŠ¡å®ä¾‹å‘é€è¯·æ±‚ã€‚Nacos æ”¯æŒä¼ è¾“å±‚ (PING æˆ– TCP)å’Œåº”ç”¨å±‚ (å¦‚ HTTPã€MySQLã€ç”¨æˆ·è‡ªå®šä¹‰ï¼‰çš„å¥åº·æ£€æŸ¥ã€‚ å¯¹äºå¤æ‚çš„äº‘ç¯å¢ƒå’Œç½‘ç»œæ‹“æ‰‘ç¯å¢ƒä¸­ï¼ˆå¦‚ VPCã€è¾¹ç¼˜ç½‘ç»œç­‰ï¼‰æœåŠ¡çš„å¥åº·æ£€æŸ¥ï¼ŒNacos æä¾›äº† agent ä¸ŠæŠ¥æ¨¡å¼å’ŒæœåŠ¡ç«¯ä¸»åŠ¨æ£€æµ‹2ç§å¥åº·æ£€æŸ¥æ¨¡å¼ã€‚Nacos è¿˜æä¾›äº†ç»Ÿä¸€çš„å¥åº·æ£€æŸ¥ä»ªè¡¨ç›˜ï¼Œå¸®åŠ©æ‚¨æ ¹æ®å¥åº·çŠ¶æ€ç®¡ç†æœåŠ¡çš„å¯ç”¨æ€§åŠæµé‡ã€‚</p><h3 id="æ³¨å†Œä¸­å¿ƒåŸç†"><a href="#æ³¨å†Œä¸­å¿ƒåŸç†" class="headerlink" title="æ³¨å†Œä¸­å¿ƒåŸç†"></a>æ³¨å†Œä¸­å¿ƒåŸç†</h3><p>åœ¨ä½¿ç”¨æ³¨å†Œä¸­å¿ƒæ—¶ï¼Œä¸€å…±æœ‰ä¸‰ç§è§’è‰²ï¼šæœåŠ¡æä¾›è€…ï¼ˆService Providerï¼‰ã€æœåŠ¡æ¶ˆè´¹è€…ï¼ˆService Consumerï¼‰ã€æ³¨å†Œä¸­å¿ƒï¼ˆRegistryï¼‰ã€‚</p><p><img src="/images/nacos/nacos-dis.png" alt="ç‚¹å‡»"></p><ol><li>Providerï¼š</li></ol><ul><li>å¯åŠ¨æ—¶ï¼Œå‘ Registry <strong>æ³¨å†Œ</strong>è‡ªå·±ä¸ºä¸€ä¸ªæœåŠ¡ï¼ˆServiceï¼‰çš„å®ä¾‹ï¼ˆInstanceï¼‰ã€‚</li><li>åŒæ—¶ï¼Œå®šæœŸå‘ Registry å‘é€<strong>å¿ƒè·³</strong>ï¼Œå‘Šè¯‰è‡ªå·±è¿˜å­˜æ´»ã€‚</li><li>å…³é—­æ—¶ï¼Œå‘ Registry <strong>å–æ¶ˆæ³¨å†Œ</strong>ã€‚</li></ul><ol start="2"><li>Consumerï¼š</li></ol><ul><li>å¯åŠ¨æ—¶ï¼Œå‘ Registry <strong>è®¢é˜…</strong>ä½¿ç”¨åˆ°çš„æœåŠ¡ï¼Œå¹¶ç¼“å­˜æœåŠ¡çš„å®ä¾‹åˆ—è¡¨åœ¨å†…å­˜ä¸­ã€‚</li><li>åç»­ï¼ŒConsumer å‘å¯¹åº”æœåŠ¡çš„ Provider å‘èµ·<strong>è°ƒç”¨</strong>æ—¶ï¼Œä»å†…å­˜ä¸­çš„è¯¥æœåŠ¡çš„å®ä¾‹åˆ—è¡¨é€‰æ‹©ä¸€ä¸ªï¼Œè¿›è¡Œè¿œç¨‹è°ƒç”¨ã€‚</li><li>å…³é—­æ—¶ï¼Œå‘ Registry <strong>å–æ¶ˆè®¢é˜…</strong>ã€‚</li></ul><ol start="3"><li>Registryï¼š</li></ol><ul><li>Provider è¶…è¿‡ä¸€å®šæ—¶é—´æœª<strong>å¿ƒè·³</strong>æ—¶ï¼Œä»æœåŠ¡çš„å®ä¾‹åˆ—è¡¨ç§»é™¤ã€‚</li><li>æœåŠ¡çš„å®ä¾‹åˆ—è¡¨å‘ç”Ÿå˜åŒ–ï¼ˆæ–°å¢æˆ–è€…ç§»é™¤ï¼‰æ—¶ï¼Œé€šçŸ¥è®¢é˜…è¯¥æœåŠ¡çš„ Consumerï¼Œä»è€Œè®© Consumer èƒ½å¤Ÿåˆ·æ–°æœ¬åœ°ç¼“å­˜ã€‚</li></ul><p>å½“ç„¶ï¼Œä¸åŒçš„æ³¨å†Œä¸­å¿ƒå¯èƒ½åœ¨å®ç°åŸç†ä¸Šä¼šç•¥æœ‰å·®å¼‚ã€‚ä¾‹å¦‚è¯´ï¼Œ<a href="https://github.com/Netflix/eureka/">Eureka</a> æ³¨å†Œä¸­å¿ƒï¼Œå¹¶ä¸æä¾›é€šçŸ¥åŠŸèƒ½ï¼Œè€Œæ˜¯ Eureka Client è‡ªå·±å®šæœŸè½®è¯¢ï¼Œå®ç°æœ¬åœ°ç¼“å­˜çš„æ›´æ–°ã€‚</p><p>å¦å¤–ï¼ŒProvider å’Œ Consumer æ˜¯è§’è‰²ä¸Šçš„å®šä¹‰ï¼Œä¸€ä¸ªæœåŠ¡<strong>åŒæ—¶</strong>å³å¯ä»¥æ˜¯ Provider ä¹Ÿå¯ä»¥ä½œä¸º Consumerã€‚ä¾‹å¦‚è¯´ï¼Œä¼˜æƒ åŠµæœåŠ¡å¯ä»¥ç»™è®¢å•æœåŠ¡æä¾›æ¥å£ï¼ŒåŒæ—¶åˆè°ƒç”¨ç”¨æˆ·æœåŠ¡æä¾›çš„æ¥å£ã€‚</p><h3 id="å¿«é€Ÿå¼€å§‹"><a href="#å¿«é€Ÿå¼€å§‹" class="headerlink" title="å¿«é€Ÿå¼€å§‹"></a>å¿«é€Ÿå¼€å§‹</h3><h4 id="å¼•å…¥ä¾èµ–"><a href="#å¼•å…¥ä¾èµ–" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring.cloud.alibaba.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="ç”Ÿäº§è€…"><a href="#ç”Ÿäº§è€…" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h4><p>é…ç½®æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">demo-provider</span> <span class="hljs-comment"># Spring åº”ç”¨å</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-comment"># Nacos ä½œä¸ºæ³¨å†Œä¸­å¿ƒçš„é…ç½®é¡¹ï¼Œå¯¹åº” NacosDiscoveryProperties é…ç½®ç±»</span><br>      <span class="hljs-attr">discovery:</span><br>        <span class="hljs-attr">server-addr:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8848</span> <span class="hljs-comment"># Nacos æœåŠ¡å™¨åœ°å€</span><br>        <span class="hljs-attr">service:</span> <span class="hljs-string">$&#123;spring.application.name&#125;</span> <span class="hljs-comment"># æ³¨å†Œåˆ° Nacos çš„æœåŠ¡åã€‚é»˜è®¤å€¼ä¸º $&#123;spring.application.name&#125;ã€‚</span><br><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">18080</span> <span class="hljs-comment"># æœåŠ¡å™¨ç«¯å£ã€‚é»˜è®¤ä¸º 8080</span><br></code></pre></td></tr></table></figure><p>é‡ç‚¹çœ‹ <code>spring.cloud.nacos.discovery</code> é…ç½®é¡¹ï¼Œå®ƒæ˜¯ Nacos Discovery é…ç½®é¡¹çš„å‰ç¼€ï¼Œå¯¹åº” <a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-nacos-discovery/src/main/java/com/alibaba/cloud/nacos/NacosDiscoveryProperties.java">NacosDiscoveryProperties</a> é…ç½®é¡¹ã€‚</p><p>åˆ›å»º DemoProviderApplication ç±»ï¼Œåˆ›å»ºåº”ç”¨å¯åŠ¨ç±»ï¼Œå¹¶æä¾› HTTP æ¥å£ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableDiscoveryClient</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DemoProviderApplication</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(DemoProviderApplication.class, args);<br>    &#125;<br><br>    <span class="hljs-meta">@RestController</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestController</span> </span>&#123;<br><br>        <span class="hljs-meta">@GetMapping(&quot;/echo&quot;)</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">echo</span><span class="hljs-params">(String name)</span> </span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;provider:&quot;</span> + name;<br>        &#125;<br><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><ol><li><p><code>@SpringBootApplication</code> æ³¨è§£ï¼Œè¢«æ·»åŠ åœ¨ç±»ä¸Šï¼Œå£°æ˜è¿™æ˜¯ä¸€ä¸ª Spring Boot åº”ç”¨ã€‚Spring Cloud æ˜¯æ„å»ºåœ¨ Spring Boot ä¹‹ä¸Šçš„ï¼Œæ‰€ä»¥éœ€è¦æ·»åŠ ã€‚</p></li><li><p><a href="https://github.com/spring-cloud/spring-cloud-commons/blob/master/spring-cloud-commons/src/main/java/org/springframework/cloud/client/discovery/EnableDiscoveryClient.java"><code>@EnableDiscoveryClient</code></a> æ³¨è§£ï¼Œå¼€å¯ Spring Cloud çš„æ³¨å†Œå‘ç°åŠŸèƒ½ã€‚ä¸è¿‡ä» Spring Cloud Edgware ç‰ˆæœ¬å¼€å§‹ï¼Œå®é™…ä¸Šå·²ç»ä¸éœ€è¦æ·»åŠ  <code>@EnableDiscoveryClient</code> æ³¨è§£ï¼Œåªéœ€è¦å¼•å…¥ Spring Cloud æ³¨å†Œå‘ç°ç»„ä»¶ï¼Œå°±ä¼šè‡ªåŠ¨å¼€å¯æ³¨å†Œå‘ç°çš„åŠŸèƒ½ã€‚ä¾‹å¦‚è¯´ï¼Œæˆ‘ä»¬è¿™é‡Œå·²ç»å¼•å…¥äº† <code>spring-cloud-starter-alibaba-nacos-discovery</code> ä¾èµ–ï¼Œå°±ä¸ç”¨å†æ·»åŠ  <code>@EnableDiscoveryClient</code> æ³¨è§£äº†ã€‚</p></li></ol><h4 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h4><p>é…ç½®æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">demo-provider</span> <span class="hljs-comment"># Spring åº”ç”¨å</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-comment"># Nacos ä½œä¸ºæ³¨å†Œä¸­å¿ƒçš„é…ç½®é¡¹ï¼Œå¯¹åº” NacosDiscoveryProperties é…ç½®ç±»</span><br>      <span class="hljs-attr">discovery:</span><br>        <span class="hljs-attr">server-addr:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8848</span> <span class="hljs-comment"># Nacos æœåŠ¡å™¨åœ°å€</span><br>        <span class="hljs-attr">service:</span> <span class="hljs-string">$&#123;spring.application.name&#125;</span> <span class="hljs-comment"># æ³¨å†Œåˆ° Nacos çš„æœåŠ¡åã€‚é»˜è®¤å€¼ä¸º $&#123;spring.application.name&#125;ã€‚</span><br><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">28080</span> <span class="hljs-comment"># æœåŠ¡å™¨ç«¯å£ã€‚é»˜è®¤ä¸º 8080</span><br></code></pre></td></tr></table></figure><p>åˆ›å»º DemoConsumerApplicationç±»ï¼Œåˆ›å»ºåº”ç”¨å¯åŠ¨ç±»ï¼Œå¹¶æä¾›ä¸€ä¸ªè°ƒç”¨æœåŠ¡æä¾›è€…çš„ HTTP æ¥å£ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-comment">// @EnableDiscoveryClient</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DemoConsumerApplication</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(DemoConsumerApplication.class, args);<br>    &#125;<br><br>    <span class="hljs-meta">@Configuration</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RestTemplateConfiguration</span> </span>&#123;<br><br>        <span class="hljs-meta">@Bean</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title">restTemplate</span><span class="hljs-params">()</span> </span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestTemplate();<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-meta">@RestController</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestController</span> </span>&#123;<br><br>        <span class="hljs-meta">@Autowired</span><br>        <span class="hljs-keyword">private</span> DiscoveryClient discoveryClient;<br>        <span class="hljs-meta">@Autowired</span><br>        <span class="hljs-keyword">private</span> RestTemplate restTemplate;<br>        <span class="hljs-meta">@Autowired</span><br>        <span class="hljs-keyword">private</span> LoadBalancerClient loadBalancerClient;<br><br>        <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">(String name)</span> </span>&#123;<br>            <span class="hljs-comment">// &lt;1&gt; è·å¾—æœåŠ¡ `demo-provider` çš„ä¸€ä¸ªå®ä¾‹</span><br>            ServiceInstance instance;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">true</span>) &#123;<br>                <span class="hljs-comment">// è·å–æœåŠ¡ `demo-provider` å¯¹åº”çš„å®ä¾‹åˆ—è¡¨</span><br>                List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(<span class="hljs-string">&quot;demo-provider&quot;</span>);<br>                <span class="hljs-comment">// é€‰æ‹©ç¬¬ä¸€ä¸ª</span><br>                instance = instances.size() &gt; <span class="hljs-number">0</span> ? instances.get(<span class="hljs-number">0</span>) : <span class="hljs-keyword">null</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                instance = loadBalancerClient.choose(<span class="hljs-string">&quot;demo-provider&quot;</span>);<br>            &#125;<br>            <span class="hljs-comment">// &lt;2&gt; å‘èµ·è°ƒç”¨</span><br>            <span class="hljs-keyword">if</span> (instance == <span class="hljs-keyword">null</span>) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(<span class="hljs-string">&quot;è·å–ä¸åˆ°å®ä¾‹&quot;</span>);<br>            &#125;<br>            String targetUrl = instance.getUri() + <span class="hljs-string">&quot;/echo?name=&quot;</span> + name;<br>            String response = restTemplate.getForObject(targetUrl, String.class);<br>            <span class="hljs-comment">// è¿”å›ç»“æœ</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;consumer:&quot;</span> + response;<br>        &#125;<br><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><ol><li><p><code>@EnableDiscoveryClient</code> æ³¨è§£ï¼Œå› ä¸ºå·²ç»æ— éœ€æ·»åŠ ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿›è¡Œäº†æ³¨é‡Šï¼ŒåŸå› åœ¨ä¸Šé¢å·²ç»è§£é‡Šè¿‡ã€‚</p></li><li><p>RestTemplateConfiguration é…ç½®ç±»ï¼Œåˆ›å»º <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-web/src/main/java/org/springframework/web/client/RestTemplate.java">RestTemplate</a> Beanã€‚RestTemplate æ˜¯ Spring æä¾›çš„ HTTP è°ƒç”¨æ¨¡æ¿å·¥å…·ç±»ï¼Œå¯ä»¥æ–¹ä¾¿æˆ‘ä»¬ç¨åè°ƒç”¨æœåŠ¡æä¾›è€…çš„ HTTP APIã€‚</p></li><li><p>TestController æä¾›äº† <code>/hello</code> æ¥å£ï¼Œç”¨äºè°ƒç”¨æœåŠ¡æä¾›è€…çš„ <code>/demo</code> æ¥å£ã€‚ä»£ç ç•¥å¾®æœ‰å‡ è¡Œï¼Œæˆ‘ä»¬æ¥ç¨å¾®è§£é‡Šä¸‹å“ˆã€‚</p></li></ol><p><code>discoveryClient</code> å±æ€§ï¼ŒDiscoveryClient å¯¹è±¡ï¼ŒæœåŠ¡å‘ç°å®¢æˆ·ç«¯ï¼Œä¸Šæ–‡æˆ‘ä»¬å·²ç»ä»‹ç»è¿‡ã€‚è¿™é‡Œæˆ‘ä»¬æ³¨å…¥çš„ä¸æ˜¯ Nacos Discovery æä¾›çš„ NacosDiscoveryClientï¼Œä¿è¯é€šç”¨æ€§ã€‚æœªæ¥å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨ Nacos ä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Œè€Œæ˜¯ä½¿ç”¨ Eureka æˆ–åˆ™ Zookeeper æ—¶ï¼Œåˆ™æ— éœ€æ”¹åŠ¨è¿™é‡Œçš„ä»£ç ã€‚</p><p><code>loadBalancerClient</code> å±æ€§ï¼Œ<a href="https://github.com/spring-cloud/spring-cloud-commons/blob/master/spring-cloud-commons/src/main/java/org/springframework/cloud/client/loadbalancer/LoadBalancerClient.java">LoadBalancerClient</a> å¯¹è±¡ï¼Œè´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯ã€‚ç¨åæˆ‘ä»¬ä¼šä½¿ç”¨å®ƒï¼Œä» Nacos è·å–çš„æœåŠ¡ <code>demo-provider</code> çš„å®ä¾‹åˆ—è¡¨ä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªè¿›è¡Œ HTTP è°ƒç”¨ã€‚</p><blockquote><p>æ‹“å±•å°çŸ¥è¯†ï¼šåœ¨ Spring Cloud Common é¡¹ç›®ä¸­ï¼Œå®šä¹‰äº†<a href="https://github.com/spring-cloud/spring-cloud-commons/blob/master/spring-cloud-commons/src/main/java/org/springframework/cloud/client/loadbalancer/LoadBalancerClient.java">LoadBalancerClient</a> æ¥å£ï¼Œä½œä¸ºé€šç”¨çš„è´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯ï¼Œæä¾›ä»æŒ‡å®šæœåŠ¡ä¸­é€‰æ‹©ä¸€ä¸ªå®ä¾‹ã€å¯¹æŒ‡å®šæœåŠ¡å‘èµ·è¯·æ±‚ç­‰ API æ–¹æ³•ã€‚è€Œæƒ³è¦é›†æˆåˆ° Spring Cloud ä½“ç³»çš„è´Ÿè½½å‡è¡¡çš„ç»„ä»¶ï¼Œéœ€è¦æä¾›å¯¹åº”çš„ LoadBalancerClient å®ç°ç±»ã€‚</p><p>ä¾‹å¦‚è¯´ï¼ŒSpring Cloud Netflix Ribbon æä¾›äº† <a href="https://github.com/spring-cloud/spring-cloud-netflix/blob/2.2.x/spring-cloud-netflix-ribbon/src/main/java/org/springframework/cloud/netflix/ribbon/RibbonLoadBalancerClient.java">RibbonLoadBalancerClient</a> å®ç°ã€‚</p><p>å¦‚æ­¤ï¼Œæ‰€æœ‰éœ€è¦ä½¿ç”¨åˆ°çš„åœ°æ–¹ï¼Œåªéœ€è¦è·å–åˆ° DiscoveryClient å®¢æˆ·ç«¯ï¼Œè€Œæ— éœ€å…³æ³¨å…·ä½“å®ç°ï¼Œä¿è¯å…¶é€šç”¨æ€§ã€‚ğŸ˜ˆ ä¸è¿‡è²Œä¼¼ Spring Cloud ä½“ç³»ä¸­ï¼Œæš‚æ—¶åªæœ‰ Ribbon ä¸€ä¸ªè´Ÿè½½å‡è¡¡ç»„ä»¶ã€‚</p><p>å½“ç„¶ï¼ŒLoadBalancerClient çš„æœåŠ¡çš„å®ä¾‹åˆ—è¡¨ï¼Œæ˜¯æ¥è‡ª DiscoveryClient æä¾›çš„ã€‚</p></blockquote><p><code>/hello</code> æ¥å£ï¼Œç¤ºä¾‹æ¥å£ï¼Œå¯¹æœåŠ¡æä¾›è€…å‘èµ·ä¸€æ¬¡ HTTP è°ƒç”¨ã€‚</p><ul><li><code>&lt;1&gt;</code> å¤„ï¼Œè·å¾—æœåŠ¡ <code>demo-provider</code> çš„ä¸€ä¸ªå®ä¾‹ã€‚è¿™é‡Œæˆ‘ä»¬æä¾›äº†ä¸¤ç§æ–¹å¼çš„ä»£ç ï¼Œåˆ†åˆ«åŸºäº DiscoveryClient å’Œ LoadBalancerClientã€‚</li><li><code>&lt;2&gt;</code> å¤„ï¼Œé€šè¿‡è·å–åˆ°çš„æœåŠ¡å®ä¾‹ ServiceInstance å¯¹è±¡ï¼Œæ‹¼æ¥è¯·æ±‚çš„ç›®æ ‡ URLï¼Œä¹‹åä½¿ç”¨ RestTemplate å‘èµ· HTTP è°ƒç”¨ã€‚</li></ul><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>è®¿é—®ï¼š<a href="http://127.0.0.1:28080/hello?name=mengsu">http://127.0.0.1:28080/hello?name=mengsu</a> ï¼Œè¿”å›ç»“æœä¸º <code>&quot;consumer:provider:mengsu&quot;</code>ã€‚è¯´æ˜ï¼Œè°ƒç”¨è¿œç¨‹çš„<strong>æœåŠ¡æä¾›è€…</strong>æˆåŠŸã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Nacos</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Typoraå¿«æ·é”®</title>
    <link href="/2021/07/26/Typora%E5%BF%AB%E6%8D%B7%E9%94%AE/"/>
    <url>/2021/07/26/Typora%E5%BF%AB%E6%8D%B7%E9%94%AE/</url>
    
    <content type="html"><![CDATA[<h1 id="Typoraå¿«æ·é”®"><a href="#Typoraå¿«æ·é”®" class="headerlink" title="Typoraå¿«æ·é”®"></a>Typoraå¿«æ·é”®</h1><p>æœ€å¤§æ ‡é¢˜ï¼šcommand + 1 æˆ–è€…ï¼š#<br> å¤§æ ‡é¢˜ï¼šcommand + 2 æˆ–è€…ï¼š##<br> æ ‡å‡†æ ‡é¢˜ï¼šcommand + 3 æˆ–è€…ï¼š###<br> ä¸­æ ‡é¢˜ï¼šcommand + 4 æˆ–è€…ï¼š####<br> å°æ ‡é¢˜ï¼šcommand + 5 æˆ–è€…ï¼š#####<br> æ’å…¥è¡¨æ ¼ï¼šcommand + T<br> æ’å…¥ä»£ç ï¼šcommand + alt +c<br> æ’å…¥å›¾ç‰‡ï¼šcmd + ctrl + i<br> è¡Œé—´å…¬å¼ command + Alt + b<br> æ®µè½ï¼šcommand + 0<br> ç«–çº¿ ï¼š command + Alt +q<br> æ— éœ€åˆ—è¡¨ï¼šcommand+option+U<br> æœ‰åºåˆ—è¡¨ï¼ˆ1. 2.ï¼‰ ï¼šè¾“å…¥æ•°å­—+â€œ.â€ä¹‹åè¾“ å…¥ç©ºæ ¼ æˆ–è€…ï¼šcommand + Alt + o<br> é»‘ç‚¹æ ‡è®°ï¼šcommand + Alt + u<br> éš”ç¦»çº¿shift + command + -<br> è¶…é“¾æ¥ï¼šcommand + Alt + l<br> æ’å…¥é“¾æ¥ï¼šcommand +k<br> ä¸‹åˆ’çº¿ï¼šcommand +u<br> åŠ ç²—ï¼šcommand +b<br> æœç´¢ï¼šcommand +f<br> å¼•ç”¨ï¼šcommand+option+Q</p>]]></content>
    
    
    
    <tags>
      
      <tag>Typora</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nacoså®‰è£…è¿è¡Œ</title>
    <link href="/2021/07/26/nacos-install/"/>
    <url>/2021/07/26/nacos-install/</url>
    
    <content type="html"><![CDATA[<h2 id="å¿«é€Ÿå¼€å§‹"><a href="#å¿«é€Ÿå¼€å§‹" class="headerlink" title="å¿«é€Ÿå¼€å§‹"></a><a href="https://nacos.io/zh-cn/">å¿«é€Ÿå¼€å§‹</a></h2><h3 id="Dockerä¸‹è½½å®‰è£…"><a href="#Dockerä¸‹è½½å®‰è£…" class="headerlink" title="Dockerä¸‹è½½å®‰è£…"></a>Dockerä¸‹è½½å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull nacos/nacos-server<br></code></pre></td></tr></table></figure><h3 id="DockeræŸ¥çœ‹é•œåƒ"><a href="#DockeræŸ¥çœ‹é•œåƒ" class="headerlink" title="DockeræŸ¥çœ‹é•œåƒ"></a>DockeræŸ¥çœ‹é•œåƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker images<br></code></pre></td></tr></table></figure><h3 id="Dockerè¿è¡Œ"><a href="#Dockerè¿è¡Œ" class="headerlink" title="Dockerè¿è¡Œ"></a>Dockerè¿è¡Œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d \<br>-e MODE=standalone \<br>-e SPRING_DATASOURCE_PLATFORM=mysql \<br>-e MYSQL_SERVICE_HOST=docker.for.mac.host.internal \<br>-e MYSQL_SERVICE_PORT=3306 \<br>-e MYSQL_SERVICE_USER=root \<br>-e MYSQL_SERVICE_PASSWORD=123456 \<br>-e MYSQL_SERVICE_DB_NAME=nacos_config \<br>-p 8848:8848 \<br>--restart=always \<br>nacos/nacos-server<br></code></pre></td></tr></table></figure><p>å¤‡æ³¨ï¼šè¿æ¥æ•°æ®åº“éœ€è¦å¯¼å…¥nacosè‡ªå·±çš„<a href="https://github.com/alibaba/nacos/edit/master/distribution/conf/nacos-mysql.sql">æ•°æ®åº“è„šæœ¬</a>ï¼Œè¯¥æ¨¡å¼ä¸ºå•æœºå¯åŠ¨</p><h3 id="DockeræŸ¥çœ‹è¿è¡ŒçŠ¶æ€"><a href="#DockeræŸ¥çœ‹è¿è¡ŒçŠ¶æ€" class="headerlink" title="DockeræŸ¥çœ‹è¿è¡ŒçŠ¶æ€"></a>DockeræŸ¥çœ‹è¿è¡ŒçŠ¶æ€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker ps<br></code></pre></td></tr></table></figure><h3 id="è®¿é—®åœ°å€"><a href="#è®¿é—®åœ°å€" class="headerlink" title="è®¿é—®åœ°å€"></a>è®¿é—®åœ°å€</h3><p><a href="http://127.0.0.1:8848/">http://127.0.0.1:8848/</a>  ï¼Œé»˜è®¤è´¦å¯†éƒ½æ˜¯ï¼šnacos</p><h3 id="ç³»ç»Ÿæˆªå›¾"><a href="#ç³»ç»Ÿæˆªå›¾" class="headerlink" title="ç³»ç»Ÿæˆªå›¾"></a>ç³»ç»Ÿæˆªå›¾</h3><p><img src="/images/nacos/nacos-show.png" alt="ç‚¹å‡»"></p>]]></content>
    
    
    
    <tags>
      
      <tag>Nacos</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo</title>
    <link href="/2021/07/23/hello-world/"/>
    <url>/2021/07/23/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
